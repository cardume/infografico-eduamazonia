function loadSection(a){$(".main-section").hide();$("#"+a).show();if(a=="navegue"&&sectionLoaded[a]==false){if(!$.browser.safari){var b={};var c=$("#navegue #data");c.jScrollPane(b);resultsScrollApi=c.data("jsp")}$.getJSON("constatacoes.json.php?data=geral",function(a){irregularidadesData=a});$.getJSON("constatacoes.json.php?data=tipo",function(a){eduamazonia.tipo=a;$.each(eduamazonia.tipo,function(a,b){$("select.tipo").append('<option value="'+b.tipo+'">'+b.tipo+"</option>")});jQuery("select.tipo").chosen().trigger("liszt:updated")});$.getJSON("constatacoes.json.php?data=programa",function(a){eduamazonia.programa=a;$.each(eduamazonia.programa,function(a,b){$("select.programa").append('<option value="'+b.programa+'">'+b.programa_desc+"</option>")});jQuery("select.programa").chosen().trigger("liszt:updated")});$.getJSON("constatacoes.json.php?data=cidade",function(a){eduamazonia.cidade=a;$.each(eduamazonia.cidade,function(a,b){$("select.cidade").append('<option value="'+b.cidade+'">'+b.cidade+" - "+b.estado+"</option>")});jQuery("select.cidade").chosen().trigger("liszt:updated");var b=mmg().factory(m).url("cidades.geojson",function(a,b){mmg_interaction(b)});e.addLayer(b)});$("select").chosen({allow_single_deselect:true}).change(function(){categories=[];i=0;$("select.filter").each(function(){var a=$(this).find("option:selected").val();var b=$(this).data("type");if(a){selectedFilters[b]=a}else{categories[i]=b;delete selectedFilters[b];i++}});if($(this).hasClass("cidade")){var a=$(this).find("option:selected").val();if(a){var b=$(this).find("option:selected").data("lat");var c=$(this).find("option:selected").data("lon");n(b,c,8,a)}else{n(-2,-57,4)}}if(!$.isEmptyObject(selectedFilters)){updateCurrentData()}d();theMagic()});function d(){if($.isEmptyObject(selectedFilters)){$("select.filter option").attr("disabled",false);$(".cidade-marker").show();$("select.filter").chosen().trigger("liszt:updated")}else{$.each(categories,function(a,b){$("select."+b+" option").attr("disabled",true);if(b=="cidade")$(".cidade-marker").hide();$.each(currentData[b],function(a,c){var d=$("select."+b+' option[value="'+c[b]+'"]');d.attr("disabled",false);if(b=="cidade")$('.cidade-marker[data-cidade="'+c[b]+'"]').show()});$("select."+b).chosen().trigger("liszt:updated")})}}var e;var f={tilejson:"1.0.0",scheme:"xyz",tiles:["http://maps.cardume.art.br/v2/eduamazonia_marcador/{z}/{x}/{y}.png"],formatter:function(a,b){return b}};e=new MM.Map("filter_map",new wax.mm.connector(f),null);e.setCenterZoom(new MM.Location(-56,-5),4);wax.mm.zoomer(e).appendTo(e.parent);wax.mm.interaction().map(e).tilejson(tilejson);var g=easey().map(e).easing("easeInOut");var h=4;var j=8;var k=new MM.Location(6,-77);var l=new MM.Location(-15,-43);e.setZoomRange(h,j);e.coordLimits=[e.locationCoordinate(k).zoomTo(h),e.locationCoordinate(l).zoomTo(j)];layer.tileLimits=[e.locationCoordinate(k).zoomTo(h),e.locationCoordinate(l).zoomTo(j)];sectionLoaded[a]=true;function m(a){var b=document.createElement("div");b.className="cidade-marker";$(b).attr("data-cidade",a.id).data("lat",a.properties.geo_latitude).data("lon",a.properties.geo_longitude).append('<span class="cidade-tip">'+a.id+" - "+a.properties.estado+"</span>");$('option[value="'+a.id+'"]').data("lat",a.properties.geo_latitude).data("lon",a.properties.geo_longitude);return b}$(".cidade-marker").live("click",function(){var a=$(this).data("lat");var b=$(this).data("lon");var c=$(this).data("cidade");n(a,b,8,c);$("select.cidade option").attr("selected",false);$('select.cidade option[value="'+c+'"]').attr("selected",true);$("select.cidade").chosen().trigger("liszt:updated").change()});function n(a,b,c,d){easey().map(e).to(e.locationCoordinate({lat:a,lon:b}).zoomTo(c)).run(2e3);$(".cidade-marker").removeClass("active");if(d)$('.cidade-marker[data-cidade="'+d+'"]').addClass("active")}}}function updateCurrentData(){currentData={};$.each(categories,function(a,b){currentData[b]=getCategoryData(selectedFilters,b)});currentData.irregularidades=getIrregularidades(selectedFilters)}function getData(a,b){var c={};$.each(b,function(b,d){c[d]=getCategoryData(a,d)});c.irregularidades=getIrregularidades(a);return c}function getCategoryData(a,b){var c=[];var d=0;$.each(eduamazonia[b],function(e,f){var g={};var h;g[b]=f[b];var j=$.extend({},a,g);h=getIrregularidadesCount(j);if(h>=1){c[d]=f;c[d].count=h;d++}});var e=jLinq.from(c).sort("-count").select();return e}function addFilter(a,b){$("select."+a+" option").attr("selected",false);$("select."+a+' option[value="'+b+'"]').attr("selected",true);$("select."+a).chosen().trigger("liszt:updated").change();return false}function clearFilter(a){$("select."+a+"option").attr("selected",false);$("select."+a).chosen().trigger("liszt:updated").change();return false}function getIrregularidadesCount(a){var b=jLinq.from(irregularidadesData);jQuery.each(a,function(a,c){b=b.starts(a,c)});return b.count()}function getIrregularidades(a){var b=jLinq.from(irregularidadesData);jQuery.each(a,function(a,c){b=b.starts(a,c)});return b.select()}function theMagic(){var a=$("#data");var b=a.find("header .inside");var c=a.find("#data-table");var d=a.find("#links");var e=a.find("#graphs");var f=a.find("#irregularidades");b.empty();c.empty();d.empty();e.empty();f.removeClass("active").empty();if($.isEmptyObject(selectedFilters)){a.find(".landing").show();if(!$.browser.safari)resultsScrollApi.reinitialise();return false}else a.find(".landing").hide();var g={};var h="";$.each(selectedFilters,function(a,b){h+=b});if(selectedFilters.cidade&&!selectedFilters.programa&&!selectedFilters.tipo){h=selectedFilters.cidade}else if(selectedFilters.cidade&&selectedFilters.programa&&!selectedFilters.tipo){h=selectedFilters.programa+" na cidade de "+selectedFilters.cidade}else if(selectedFilters.cidade&&!selectedFilters.programa&&selectedFilters.tipo){h=selectedFilters.tipo+" na cidade de "+selectedFilters.cidade}else if(selectedFilters.cidade&&selectedFilters.programa&&selectedFilters.tipo){h=selectedFilters.tipo+" em "+selectedFilters.programa+" na cidade de "+selectedFilters.cidade}else if(!selectedFilters.cidade&&selectedFilters.programa&&selectedFilters.tipo){h=selectedFilters.tipo+" em "+selectedFilters.programa}b.append("<h2>"+h+"</h2>");if(selectedFilters.cidade&&!selectedFilters.tipo&&!selectedFilters.programa){e.append('<div id="graph01" class="graph-container"></div>');drawCidade(selectedFilters,"graph01");$("#graph01").before("<h3>Irregularidades por programa na cidade</h3>");g.programa=currentData.programa;var i="";i+='<table><tbody><tr><th class="n">Número de irregularidades</th><th>Programas do governo</th><th class="m">Média das cidades fiscalizadas</th></tr>';var j=0;var k=0;$.each(eduamazonia.programa,function(a,b){var c=jLinq.from(g.programa).starts("programa",b.programa).select();$.each(c,function(a,b){c=b});var d=c.count;var e;if(!d){d="--";e=false}else{j=j+d;e="class=\"filterable\" onClick=\"addFilter('programa', '"+b.programa+"');\""}var f=Math.ceil(b.constatacoes/32);k=Math.ceil(k+b.constatacoes/32);i+='<tr><td class="n">'+d+"</td><td "+e+">"+b.programa_desc+'</td><td class="m">'+f+"</td></tr>"});i+='<tr class="total"><td class="n">'+j+'</td><td>TOTAL</td><td class="m">'+k+"</td></tr>";i+="</tbody></table>";c.append(i)}else if(!selectedFilters.cidade&&selectedFilters.tipo&&!selectedFilters.programa){e.append('<div id="graph01" class="graph-container"></div><div id="graph02" class="graph-container"></div>');drawPieChart("programa","graph01");$("#graph01").before("<h3>Irregularidades por programa</h3>");drawColumnChart("cidade","graph02");$("#graph02").before("<h3>Irregularidades por cidade</h3>");g.programa=currentData.programa;var i="";i+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Programas</th><th class="n"></th></tr>';var j=0;i+='<tr><td rowspan="10" class="total"></td></tr>';$.each(eduamazonia.programa,function(a,b){var c=jLinq.from(g.programa).starts("programa",b.programa).select();$.each(c,function(a,b){c=b});var d=c.count;var e;if(!d){d="--";e=false}else{j=j+d;e="class=\"filterable\" onClick=\"addFilter('programa', '"+b.programa+"');\""}i+="<tr><td "+e+">"+b.programa_desc+'</td><td class="n">'+d+"</td></tr>"});i+="</tbody></table>";c.append(i);c.find("td.total").text(j);c.find("td.total").append("<span>irregularidades</span>")}else if(!selectedFilters.cidade&&!selectedFilters.tipo&&selectedFilters.programa){e.append('<div id="graph01" class="graph-container"></div><div id="graph02" class="graph-container"></div>');drawPieChart("tipo","graph01");$("#graph01").before("<h3>Irregularidades por tipo</h3>");drawColumnChart("cidade","graph02");$("#graph02").before("<h3>Irregularidades por cidade</h3>");g.tipo=currentData.tipo;var i="";i+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Tipos de irregularidades</th><th class="n"></th></tr>';var j=0;i+='<tr><td rowspan="6" class="total"></td></tr>';$.each(eduamazonia.tipo,function(a,b){var c=jLinq.from(g.tipo).starts("tipo",b.tipo).select();$.each(c,function(a,b){c=b});var d=c.count;var e;if(!d){d="--";e=false}else{j=j+d;e="class=\"filterable\" onClick=\"addFilter('tipo', '"+b.tipo+"');\""}i+="<tr><td "+e+">"+b.tipo+'</td><td class="n">'+d+"</td></tr>"});i+="</tbody></table>";c.append(i);c.find("td.total").text(j);c.find("td.total").append("<span>irregularidades</span>")}else if(selectedFilters.cidade&&selectedFilters.tipo&&!selectedFilters.programa){e.append('<div id="graph01" class="graph-container"></div><div id="graph02" class="graph-container"></div>');drawPieChart("programa","graph01");$("#graph01").before("<h3>Irregularidades por programa</h3>");g.programa=currentData.programa;var i="";i+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Programas</th><th class="n"></th></tr>';var j=0;i+='<tr><td rowspan="10" class="total"></td></tr>';$.each(eduamazonia.programa,function(a,b){var c=jLinq.from(g.programa).starts("programa",b.programa).select();$.each(c,function(a,b){c=b});var d=c.count;var e;if(!d){d="--";e=false}else{j=j+d;e="class=\"filterable\" onClick=\"addFilter('programa', '"+b.programa+"');\""}i+="<tr><td "+e+">"+b.programa_desc+'</td><td class="n">'+d+"</td></tr>"});i+="</tbody></table>";c.append(i);c.find("td.total").text(j);c.find("td.total").append("<span>irregularidades</span>");var l=getData({tipo:selectedFilters.tipo},["programa"]);drawPieChart("programa","graph02",l);$("#graph02").before("<h3>Comparativo com o total em todas as cidades</h3>")}else if(!selectedFilters.cidade&&selectedFilters.tipo&&selectedFilters.programa){e.append('<div id="graph01" class="graph-container"></div>');drawColumnChart("cidade","graph01");$("#graph01").before("<h3>Irregularidades por cidade</h3>");g.cidade=currentData.cidade;var i="";i+='<table class="regular"><tbody><tr><th class="total">Total</th><th>As 10 cidades com mais irregularidades</th><th class="n"></th></tr>';var j=getIrregularidadesCount(selectedFilters);i+='<tr><td rowspan="11" class="total"></td></tr>';$.each(g.cidade,function(a,b){var c="class=\"filterable\" onClick=\"addFilter('cidade', '"+b.cidade+"');\"";if(a<10)i+="<tr><td "+c+">"+b.cidade+'</td><td class="n">'+b.count+"</td></tr>"});i+="</tbody></table>";c.append(i);c.find("td.total").text(j);c.find("td.total").append("<span>irregularidades</span>")}else if(selectedFilters.cidade&&!selectedFilters.tipo&&selectedFilters.programa){e.append('<div id="graph01"></div><div id="graph02"></div>');drawPieChart("tipo","graph01");$("#graph01").before("<h3>Irregularidades por tipo</h3>");g.tipo=currentData.tipo;var i="";i+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Tipos de irregularidades</th><th class="n"></th></tr>';var j=0;i+='<tr><td rowspan="6" class="total"></td></tr>';$.each(eduamazonia.tipo,function(a,b){var c=jLinq.from(g.tipo).starts("tipo",b.tipo).select();$.each(c,function(a,b){c=b});var d=c.count;var e;if(!d){d="--";e=false}else{j=j+d;e="class=\"filterable\" onClick=\"addFilter('tipo', '"+b.tipo+"');\""}i+="<tr><td "+e+">"+b.tipo+'</td><td class="n">'+d+"</td></tr>"});i+="</tbody></table>";c.append(i);c.find("td.total").text(j);c.find("td.total").append("<span>irregularidades</span>");var l=getData({programa:selectedFilters.programa},["tipo"]);drawPieChart("tipo","graph02",l);$("#graph02").before("<h3>Comparativo com o total em todas as cidades</h3>")}else if(selectedFilters.cidade&&selectedFilters.tipo&&selectedFilters.programa){c.append('<p class="total">Total: '+getIrregularidadesCount(selectedFilters)+" irregularidades</p>")}if(Object.keys(selectedFilters).length>=2){var m=categories[0];if(m)var n=m.charAt(0).toUpperCase()+m.slice(1)+"s";if(Object.keys(selectedFilters).length==2)d.append('<a class="irregularidades-toggle button" href="#">Exibir a lista de irregularidades</a>');else f.addClass("active");var o="";o+='<table class="irregularidades"><tbody><tr>';if(m)o+='<th class="'+m+' category">'+n+"</th>";o+="<th>Irregularidades</th></tr>";$.each(currentData.irregularidades,function(a,b){o+="<tr>";if(m)o+='<td title="'+b[m]+'" class="'+m+" "+normalize(b[m])+'">'+b[m]+"</td>";o+="<td><p>"+b.constatacao+"</p></td>"});o+="</tbody></table>";f.append(o)}if(selectedFilters.cidade){var p=jLinq.from(eduamazonia.cidade).starts("cidade",selectedFilters.cidade).select();p=p[0];d.append('<a class="relatorio button" href="#" target="_blank">Veja a integra do relatório da CGU</a>');$(".relatorio.button").attr("href","relatorios/"+p.relatorio)}$(".irregularidades-toggle").click(function(){if(!f.hasClass("active")){f.addClass("active");$(this).text("Esconder a lista de irregularidades");if(!$.browser.safari)resultsScrollApi.reinitialise();$()}else{f.removeClass("active");$(this).text("Exibir a lista de irregularidades");if(!$.browser.safari)resultsScrollApi.reinitialise()}return false});if(!$.browser.safari)resultsScrollApi.reinitialise();$(".jspPane, .jspDrag").css({top:0})}function getCidadeGraphData(a){var b=[];b[0]=[];var c=a.cidade;b[0][0]="";jQuery.each(currentData.tipo,function(a,c){b[0][a+1]=c.tipo});jQuery.each(currentData.programa,function(a,d){b[a+1]=[];b[a+1][0]=d.programa_desc;jQuery.each(currentData.tipo,function(e,f){b[a+1][e+1]=getIrregularidadesCount({programa:d.programa,tipo:f.tipo,cidade:c})})});return b}function getPieGraphData(a,b){if(typeof b=="undefined")var c=currentData;else var c=b;var d=[];d[0]=[];d[0][0]="";d[0][1]="";jQuery.each(c[a],function(b,c){d[b+1]=[];d[b+1][0]=c[a];d[b+1][1]=c.count});return d}function getColumnGraphData(a,b){if(typeof b=="undefined")var c=currentData;else var c=b;var d=[];d[0]=[];d[1]=[];d[0][0]="";d[1][0]="";jQuery.each(c[a],function(b,c){d[0][b+1]=c[a];d[1][b+1]=c.count});return d}function drawPieChart(a,b,c){var d=new google.visualization.ChartWrapper({chartType:"PieChart",dataTable:getPieGraphData(a,c),options:{width:450,height:400,backgroundColor:"transparent"},containerId:b});d.draw();return}function drawColumnChart(a,b,c){var d=new google.visualization.ChartWrapper({chartType:"ColumnChart",dataTable:getColumnGraphData(a,c),options:{width:450,height:500,backgroundColor:"transparent"},containerId:b});d.draw();return}function drawCidade(a,b){var c=new google.visualization.ChartWrapper({chartType:"ComboChart",dataTable:getCidadeGraphData(a),options:{width:450,height:400,backgroundColor:"transparent",seriesType:"bars",isStacked:true},containerId:b});c.draw();return}var userAgent=navigator.userAgent.toLowerCase();$.browser.chrome=/chrome/.test(navigator.userAgent.toLowerCase());if($.browser.chrome){userAgent=userAgent.substring(userAgent.indexOf("chrome/")+7);userAgent=userAgent.substring(0,userAgent.indexOf("."));$.browser.version=userAgent;$.browser.safari=false}if($.browser.safari){userAgent=userAgent.substring(userAgent.indexOf("safari/")+7);userAgent=userAgent.substring(0,userAgent.indexOf("."));$.browser.version=userAgent}$(document).ready(function(){if(window.location!=window.parent.location)$("html,body").css({overflow:"hidden"});$("#carousel").carousel({slideSpeed:700});$("#map img").live("click",function(){return false});$(".programas-toggle").click(function(){if($("#programas-more").hasClass("active")){$("#programas-more").removeClass("active");$("#carousel .programas .graph").show();$(this).text("Saiba mais sobre os programas do Ministério da Educação")}else{$("#programas-more").addClass("active");if(!$.browser.safari)$("#programas-more").jScrollPane();$("#carousel .programas .graph").hide();$(this).text("Ocultar informações sobre os programas do Ministério da Educação")}return false});if(!$.browser.safari)$("#carousel .reportagem").jScrollPane({autoReinitialise:true})});var m;var layer;var tilejson={tilejson:"1.0.0",scheme:"xyz",tiles:["http://maps.cardume.art.br/v2/eduamazonia/{z}/{x}/{y}.png"],grids:["http://maps.cardume.art.br/v2/eduamazonia/{z}/{x}/{y}.grid.json"],formatter:function(a,b){var c="";c+='<div class="cidade-teaser dynamic-tip">';c+="<h2>"+b.cidade+"</h2>";c+="<h3>"+b.estado+"</h3>";c+='<p class="total">';c+='<span class="head">total de</span>';c+='<span class="n">'+b.constatacoes+"</span>";c+='<span class="foot">irregularidades</span>';c+="</p>";c+='<ul class="tipos">';if(b.despesa_irregular)c+="<li><span>"+b.despesa_irregular+"</span> em despesa irregular</li>";if(b.desvio_de_finalidade)c+="<li><span>"+b.desvio_de_finalidade+"</span> em desvio de finalidade</li>";if(b.falta_de_controle_administrativo)c+="<li><span>"+b.falta_de_controle_administrativo+"</span> em falta de controle administrativo</li>";if(b.falta_de_controle_social)c+="<li><span>"+b.falta_de_controle_social+"</span> em falta de controle social</li>";if(b.falta_de_prestacao_de_contas)c+="<li><span>"+b.falta_de_prestacao_de_contas+"</span> em falta de prestação de contas</li>";c+="</ul>";c+="</div>";return c}};$(document).ready(function(){layer=new wax.mm.connector(tilejson);m=new MM.Map("map",new wax.mm.connector(tilejson),null,[easey.DragHandler(),easey.TouchHandler(),easey.MouseWheelHandler(),easey.DoubleClickHandler()]);m.setCenterZoom(new MM.Location(-48,-7),4);wax.mm.zoomer(m).appendTo(m.parent);wax.mm.interaction().map(m).tilejson(tilejson).on(wax.tooltip().animate(false).parent(m.parent).events()).on({on:function(a){$(".default-tip").hide();$(".wax-tooltip .close").text("Fechar")},off:function(a){if(!$(".dynamic-tip").length)$(".default-tip").show();else $(".wax-tooltip .close").text("Fechar")}});var a=4;var b=8;var c=new MM.Location(9,-75);var d=new MM.Location(-37,-4);m.setZoomRange(a,b);m.coordLimits=[m.locationCoordinate(c).zoomTo(a),m.locationCoordinate(d).zoomTo(b)];layer.tileLimits=[m.locationCoordinate(c).zoomTo(a),m.locationCoordinate(d).zoomTo(b)]});$(document).ready(function(){$("nav#main-nav a").click(function(){var a=$(this).data("section");if(a){loadSection(a);return false}})});google.load("visualization","1",{packages:["corechart"]});var irregularidadesData;var currentData;var eduamazonia={};var selectedFilters={};var categories=[];var resultsScrollApi;var sectionLoaded={};sectionLoaded.navegue=false;(function(a){a.fn.carousel=function(b){function h(b){d.find("li").removeClass("active");d.find("[data-slide='"+b+"']").addClass("active");var e=a(".carousel-content").find("[data-slide='"+b+"']");var g=e.position();var h=g.left;c.find(".carousel-content").stop().animate({left:-h},f)}function i(){var a=d.find("li.active").data("slide");var b=c.find("[data-slide='"+a+"']").next();if(b.length)var e=b.data("slide");else var e=c.find("li:nth-child(1)").data("slide");h(e)}function j(){var a=d.find("li.active").data("slide");var b=c.find("[data-slide='"+a+"']").prev();if(b.length)var e=b.data("slide");else var e=c.find("li:last-child").data("slide");h(e)}var c=a(this);var d=a(this).find("nav");var e=c.attr("id");var f=b.slideSpeed;var g=c.find(".carousel-content > li").length;c.find(".carousel-content").each(function(){var b=a(this).find("> li").width();var c=b*g;a(this).width(c)});d.find("a").click(function(){h(a(this).parent().data("slide"));if(b.autoRotate)a.doTimeout(e,slideTimer,function(){i();return true});return false});if(b.autoRotate)a.doTimeout(e,slideTimer,function(){i();return true});c.find(".next").click(function(){i();return false});c.find(".prev").click(function(){j();return false})}})(jQuery);var normalize=function(){var a="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",b="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",c={};for(var d=0;d<a.length;d++)c[a.charAt(d)]=b.charAt(d);return function(a){var b=[];for(var d=0;d<a.length;d++){var e=a.charAt(d);if(c.hasOwnProperty(a.charAt(d)))b.push(c[e]);else b.push(e)}return b.join("").replace(/[^-A-Za-z0-9]+/g,"-").toLowerCase()}}()
