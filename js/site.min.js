function loadSection(e){$(".main-section").hide();$("#"+e).show();if(e=="navegue"&&sectionLoaded[e]==false){if(!$.browser.safari){var t={};var n=$("#navegue #data");n.jScrollPane(t);resultsScrollApi=n.data("jsp")}$.getJSON("constatacoes.json.php?data=geral",function(e){irregularidadesData=e});$.getJSON("constatacoes.json.php?data=tipo",function(e){eduamazonia.tipo=e;$.each(eduamazonia.tipo,function(e,t){$("select.tipo").append('<option value="'+t.tipo+'">'+t.tipo+"</option>")});jQuery("select.tipo").chosen().trigger("liszt:updated")});$.getJSON("constatacoes.json.php?data=programa",function(e){eduamazonia.programa=e;$.each(eduamazonia.programa,function(e,t){$("select.programa").append('<option value="'+t.programa+'">'+t.programa_desc+"</option>")});jQuery("select.programa").chosen().trigger("liszt:updated")});$.getJSON("constatacoes.json.php?data=cidade",function(e){eduamazonia.cidade=e;$.each(eduamazonia.cidade,function(e,t){$("select.cidade").append('<option value="'+t.cidade+'">'+t.cidade+" - "+t.estado+"</option>")});jQuery("select.cidade").chosen().trigger("liszt:updated");var t=mmg().factory(h).url("cidades.geojson",function(e,t){mmg_interaction(t)});s.addLayer(t)});$("select").chosen({allow_single_deselect:true}).change(function(){categories=[];i=0;$("select.filter").each(function(){var e=$(this).find("option:selected").val();var t=$(this).data("type");if(e){selectedFilters[t]=e}else{categories[i]=t;delete selectedFilters[t];i++}});if($(this).hasClass("cidade")){var e=$(this).find("option:selected").val();if(e){var t=$(this).find("option:selected").data("lat");var n=$(this).find("option:selected").data("lon");p(t,n,8,e)}else{p(-2,-57,4)}}if(!$.isEmptyObject(selectedFilters)){updateCurrentData()}r();theMagic()});function r(){if($.isEmptyObject(selectedFilters)){$("select.filter option").attr("disabled",false);$(".cidade-marker").show();$("select.filter").chosen().trigger("liszt:updated")}else{$.each(categories,function(e,t){$("select."+t+" option").attr("disabled",true);if(t=="cidade")$(".cidade-marker").hide();$.each(currentData[t],function(e,n){var r=$("select."+t+' option[value="'+n[t]+'"]');r.attr("disabled",false);if(t=="cidade")$('.cidade-marker[data-cidade="'+n[t]+'"]').show()});$("select."+t).chosen().trigger("liszt:updated")})}}var s;var o={tilejson:"1.0.0",scheme:"xyz",tiles:["http://tiles.infoamazonia.org/v2/eduamazonia_marcador/{z}/{x}/{y}.png"],formatter:function(e,t){return t}};s=new MM.Map("filter_map",new wax.mm.connector(o),null);s.setCenterZoom(new MM.Location(-56,-5),4);wax.mm.zoomer(s).appendTo(s.parent);wax.mm.interaction().map(s).tilejson(tilejson);var u=easey().map(s).easing("easeInOut");var a=4;var f=8;var l=new MM.Location(6,-77);var c=new MM.Location(-15,-43);s.setZoomRange(a,f);s.coordLimits=[s.locationCoordinate(l).zoomTo(a),s.locationCoordinate(c).zoomTo(f)];layer.tileLimits=[s.locationCoordinate(l).zoomTo(a),s.locationCoordinate(c).zoomTo(f)];sectionLoaded[e]=true;function h(e){var t=document.createElement("div");t.className="cidade-marker";$(t).attr("data-cidade",e.id).data("lat",e.properties.geo_latitude).data("lon",e.properties.geo_longitude).append('<span class="cidade-tip">'+e.id+" - "+e.properties.estado+"</span>");$('option[value="'+e.id+'"]').data("lat",e.properties.geo_latitude).data("lon",e.properties.geo_longitude);return t}$(".cidade-marker").live("click",function(){var e=$(this).data("lat");var t=$(this).data("lon");var n=$(this).data("cidade");p(e,t,8,n);$("select.cidade option").attr("selected",false);$('select.cidade option[value="'+n+'"]').attr("selected",true);$("select.cidade").chosen().trigger("liszt:updated").change()});function p(e,t,n,r){easey().map(s).to(s.locationCoordinate({lat:e,lon:t}).zoomTo(n)).run(2e3);$(".cidade-marker").removeClass("active");if(r)$('.cidade-marker[data-cidade="'+r+'"]').addClass("active")}}}function updateCurrentData(){currentData={};$.each(categories,function(e,t){currentData[t]=getCategoryData(selectedFilters,t)});currentData.irregularidades=getIrregularidades(selectedFilters)}function getData(e,t){var n={};$.each(t,function(t,r){n[r]=getCategoryData(e,r)});n.irregularidades=getIrregularidades(e);return n}function getCategoryData(e,t){var n=[];var r=0;$.each(eduamazonia[t],function(i,s){var o={};var u;o[t]=s[t];var a=$.extend({},e,o);u=getIrregularidadesCount(a);if(u>=1){n[r]=s;n[r].count=u;r++}});var i=jLinq.from(n).sort("-count").select();return i}function addFilter(e,t){$("select."+e+" option").attr("selected",false);$("select."+e+' option[value="'+t+'"]').attr("selected",true);$("select."+e).chosen().trigger("liszt:updated").change();return false}function clearFilter(e){$("select."+e+"option").attr("selected",false);$("select."+e).chosen().trigger("liszt:updated").change();return false}function getIrregularidadesCount(e){var t=jLinq.from(irregularidadesData);jQuery.each(e,function(e,n){t=t.starts(e,n)});return t.count()}function getIrregularidades(e){var t=jLinq.from(irregularidadesData);jQuery.each(e,function(e,n){t=t.starts(e,n)});return t.select()}function theMagic(){var e=$("#data");var t=e.find("header .inside");var n=e.find("#data-table");var r=e.find("#links");var i=e.find("#graphs");var s=e.find("#irregularidades");t.empty();n.empty();r.empty();i.empty();s.removeClass("active").empty();if($.isEmptyObject(selectedFilters)){e.find(".landing").show();if(!$.browser.safari)resultsScrollApi.reinitialise();return false}else e.find(".landing").hide();var o={};var u="";$.each(selectedFilters,function(e,t){u+=t});if(selectedFilters.cidade&&!selectedFilters.programa&&!selectedFilters.tipo){u=selectedFilters.cidade}else if(selectedFilters.cidade&&selectedFilters.programa&&!selectedFilters.tipo){u=selectedFilters.programa+" na cidade de "+selectedFilters.cidade}else if(selectedFilters.cidade&&!selectedFilters.programa&&selectedFilters.tipo){u=selectedFilters.tipo+" na cidade de "+selectedFilters.cidade}else if(selectedFilters.cidade&&selectedFilters.programa&&selectedFilters.tipo){u=selectedFilters.tipo+" em "+selectedFilters.programa+" na cidade de "+selectedFilters.cidade}else if(!selectedFilters.cidade&&selectedFilters.programa&&selectedFilters.tipo){u=selectedFilters.tipo+" em "+selectedFilters.programa}t.append("<h2>"+u+"</h2>");if(selectedFilters.cidade&&!selectedFilters.tipo&&!selectedFilters.programa){i.append('<div id="graph01" class="graph-container"></div>');drawCidade(selectedFilters,"graph01");$("#graph01").before("<h3>Irregularidades por programa na cidade</h3>");o.programa=currentData.programa;var a="";a+='<table><tbody><tr><th class="n">Número de irregularidades</th><th>Programas do governo</th><th class="m">Média das cidades fiscalizadas</th></tr>';var f=0;var l=0;$.each(eduamazonia.programa,function(e,t){var n=jLinq.from(o.programa).starts("programa",t.programa).select();$.each(n,function(e,t){n=t});var r=n.count;var i;if(!r){r="--";i=false}else{f=f+r;i="class=\"filterable\" onClick=\"addFilter('programa', '"+t.programa+"');\""}var s=Math.ceil(t.constatacoes/32);l=Math.ceil(l+t.constatacoes/32);a+='<tr><td class="n">'+r+"</td><td "+i+">"+t.programa_desc+'</td><td class="m">'+s+"</td></tr>"});a+='<tr class="total"><td class="n">'+f+'</td><td>TOTAL</td><td class="m">'+l+"</td></tr>";a+="</tbody></table>";n.append(a)}else if(!selectedFilters.cidade&&selectedFilters.tipo&&!selectedFilters.programa){i.append('<div id="graph01" class="graph-container"></div><div id="graph02" class="graph-container"></div>');drawPieChart("programa","graph01");$("#graph01").before("<h3>Irregularidades por programa</h3>");drawColumnChart("cidade","graph02");$("#graph02").before("<h3>Irregularidades por cidade</h3>");o.programa=currentData.programa;var a="";a+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Programas</th><th class="n"></th></tr>';var f=0;a+='<tr><td rowspan="10" class="total"></td></tr>';$.each(eduamazonia.programa,function(e,t){var n=jLinq.from(o.programa).starts("programa",t.programa).select();$.each(n,function(e,t){n=t});var r=n.count;var i;if(!r){r="--";i=false}else{f=f+r;i="class=\"filterable\" onClick=\"addFilter('programa', '"+t.programa+"');\""}a+="<tr><td "+i+">"+t.programa_desc+'</td><td class="n">'+r+"</td></tr>"});a+="</tbody></table>";n.append(a);n.find("td.total").text(f);n.find("td.total").append("<span>irregularidades</span>")}else if(!selectedFilters.cidade&&!selectedFilters.tipo&&selectedFilters.programa){i.append('<div id="graph01" class="graph-container"></div><div id="graph02" class="graph-container"></div>');drawPieChart("tipo","graph01");$("#graph01").before("<h3>Irregularidades por tipo</h3>");drawColumnChart("cidade","graph02");$("#graph02").before("<h3>Irregularidades por cidade</h3>");o.tipo=currentData.tipo;var a="";a+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Tipos de irregularidades</th><th class="n"></th></tr>';var f=0;a+='<tr><td rowspan="6" class="total"></td></tr>';$.each(eduamazonia.tipo,function(e,t){var n=jLinq.from(o.tipo).starts("tipo",t.tipo).select();$.each(n,function(e,t){n=t});var r=n.count;var i;if(!r){r="--";i=false}else{f=f+r;i="class=\"filterable\" onClick=\"addFilter('tipo', '"+t.tipo+"');\""}a+="<tr><td "+i+">"+t.tipo+'</td><td class="n">'+r+"</td></tr>"});a+="</tbody></table>";n.append(a);n.find("td.total").text(f);n.find("td.total").append("<span>irregularidades</span>")}else if(selectedFilters.cidade&&selectedFilters.tipo&&!selectedFilters.programa){i.append('<div id="graph01" class="graph-container"></div><div id="graph02" class="graph-container"></div>');drawPieChart("programa","graph01");$("#graph01").before("<h3>Irregularidades por programa</h3>");o.programa=currentData.programa;var a="";a+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Programas</th><th class="n"></th></tr>';var f=0;a+='<tr><td rowspan="10" class="total"></td></tr>';$.each(eduamazonia.programa,function(e,t){var n=jLinq.from(o.programa).starts("programa",t.programa).select();$.each(n,function(e,t){n=t});var r=n.count;var i;if(!r){r="--";i=false}else{f=f+r;i="class=\"filterable\" onClick=\"addFilter('programa', '"+t.programa+"');\""}a+="<tr><td "+i+">"+t.programa_desc+'</td><td class="n">'+r+"</td></tr>"});a+="</tbody></table>";n.append(a);n.find("td.total").text(f);n.find("td.total").append("<span>irregularidades</span>");var c=getData({tipo:selectedFilters.tipo},["programa"]);drawPieChart("programa","graph02",c);$("#graph02").before("<h3>Comparativo com o total em todas as cidades</h3>")}else if(!selectedFilters.cidade&&selectedFilters.tipo&&selectedFilters.programa){i.append('<div id="graph01" class="graph-container"></div>');drawColumnChart("cidade","graph01");$("#graph01").before("<h3>Irregularidades por cidade</h3>");o.cidade=currentData.cidade;var a="";a+='<table class="regular"><tbody><tr><th class="total">Total</th><th>As 10 cidades com mais irregularidades</th><th class="n"></th></tr>';var f=getIrregularidadesCount(selectedFilters);a+='<tr><td rowspan="11" class="total"></td></tr>';$.each(o.cidade,function(e,t){var n="class=\"filterable\" onClick=\"addFilter('cidade', '"+t.cidade+"');\"";if(e<10)a+="<tr><td "+n+">"+t.cidade+'</td><td class="n">'+t.count+"</td></tr>"});a+="</tbody></table>";n.append(a);n.find("td.total").text(f);n.find("td.total").append("<span>irregularidades</span>")}else if(selectedFilters.cidade&&!selectedFilters.tipo&&selectedFilters.programa){i.append('<div id="graph01"></div><div id="graph02"></div>');drawPieChart("tipo","graph01");$("#graph01").before("<h3>Irregularidades por tipo</h3>");o.tipo=currentData.tipo;var a="";a+='<table class="regular"><tbody><tr><th class="total">Total</th><th>Tipos de irregularidades</th><th class="n"></th></tr>';var f=0;a+='<tr><td rowspan="6" class="total"></td></tr>';$.each(eduamazonia.tipo,function(e,t){var n=jLinq.from(o.tipo).starts("tipo",t.tipo).select();$.each(n,function(e,t){n=t});var r=n.count;var i;if(!r){r="--";i=false}else{f=f+r;i="class=\"filterable\" onClick=\"addFilter('tipo', '"+t.tipo+"');\""}a+="<tr><td "+i+">"+t.tipo+'</td><td class="n">'+r+"</td></tr>"});a+="</tbody></table>";n.append(a);n.find("td.total").text(f);n.find("td.total").append("<span>irregularidades</span>");var c=getData({programa:selectedFilters.programa},["tipo"]);drawPieChart("tipo","graph02",c);$("#graph02").before("<h3>Comparativo com o total em todas as cidades</h3>")}else if(selectedFilters.cidade&&selectedFilters.tipo&&selectedFilters.programa){n.append('<p class="total">Total: '+getIrregularidadesCount(selectedFilters)+" irregularidades</p>")}if(Object.keys(selectedFilters).length>=2){var h=categories[0];if(h)var p=h.charAt(0).toUpperCase()+h.slice(1)+"s";if(Object.keys(selectedFilters).length==2)r.append('<a class="irregularidades-toggle button" href="#">Exibir a lista de irregularidades</a>');else s.addClass("active");var d="";d+='<table class="irregularidades"><tbody><tr>';if(h)d+='<th class="'+h+' category">'+p+"</th>";d+="<th>Irregularidades</th></tr>";$.each(currentData.irregularidades,function(e,t){d+="<tr>";if(h)d+='<td title="'+t[h]+'" class="'+h+" "+normalize(t[h])+'">'+t[h]+"</td>";d+="<td><p>"+t.constatacao+"</p></td>"});d+="</tbody></table>";s.append(d)}if(selectedFilters.cidade){var v=jLinq.from(eduamazonia.cidade).starts("cidade",selectedFilters.cidade).select();v=v[0];r.append('<a class="relatorio button" href="#" target="_blank">Veja a integra do relatório da CGU</a>');$(".relatorio.button").attr("href","relatorios/"+v.relatorio)}$(".irregularidades-toggle").click(function(){if(!s.hasClass("active")){s.addClass("active");$(this).text("Esconder a lista de irregularidades");if(!$.browser.safari)resultsScrollApi.reinitialise();$()}else{s.removeClass("active");$(this).text("Exibir a lista de irregularidades");if(!$.browser.safari)resultsScrollApi.reinitialise()}return false});if(!$.browser.safari)resultsScrollApi.reinitialise();$(".jspPane, .jspDrag").css({top:0})}function getCidadeGraphData(e){var t=[];t[0]=[];var n=e.cidade;t[0][0]="";jQuery.each(currentData.tipo,function(e,n){t[0][e+1]=n.tipo});jQuery.each(currentData.programa,function(e,r){t[e+1]=[];t[e+1][0]=r.programa_desc;jQuery.each(currentData.tipo,function(i,s){t[e+1][i+1]=getIrregularidadesCount({programa:r.programa,tipo:s.tipo,cidade:n})})});return t}function getPieGraphData(e,t){if(typeof t=="undefined")var n=currentData;else var n=t;var r=[];r[0]=[];r[0][0]="";r[0][1]="";jQuery.each(n[e],function(t,n){r[t+1]=[];r[t+1][0]=n[e];r[t+1][1]=n.count});return r}function getColumnGraphData(e,t){if(typeof t=="undefined")var n=currentData;else var n=t;var r=[];r[0]=[];r[1]=[];r[0][0]="";r[1][0]="";jQuery.each(n[e],function(t,n){r[0][t+1]=n[e];r[1][t+1]=n.count});return r}function drawPieChart(e,t,n){var r=new google.visualization.ChartWrapper({chartType:"PieChart",dataTable:getPieGraphData(e,n),options:{width:450,height:400,backgroundColor:"transparent"},containerId:t});r.draw();return}function drawColumnChart(e,t,n){var r=new google.visualization.ChartWrapper({chartType:"ColumnChart",dataTable:getColumnGraphData(e,n),options:{width:450,height:500,backgroundColor:"transparent"},containerId:t});r.draw();return}function drawCidade(e,t){var n=new google.visualization.ChartWrapper({chartType:"ComboChart",dataTable:getCidadeGraphData(e),options:{width:450,height:400,backgroundColor:"transparent",seriesType:"bars",isStacked:true},containerId:t});n.draw();return}var userAgent=navigator.userAgent.toLowerCase();$.browser.chrome=/chrome/.test(navigator.userAgent.toLowerCase());if($.browser.chrome){userAgent=userAgent.substring(userAgent.indexOf("chrome/")+7);userAgent=userAgent.substring(0,userAgent.indexOf("."));$.browser.version=userAgent;$.browser.safari=false}if($.browser.safari){userAgent=userAgent.substring(userAgent.indexOf("safari/")+7);userAgent=userAgent.substring(0,userAgent.indexOf("."));$.browser.version=userAgent}$(document).ready(function(){if(window.location!=window.parent.location)$("html,body").css({overflow:"hidden"});$("#carousel").carousel({slideSpeed:700});$("#map img").live("click",function(){return false});$(".programas-toggle").click(function(){if($("#programas-more").hasClass("active")){$("#programas-more").removeClass("active");$("#carousel .programas .graph").show();$(this).text("Saiba mais sobre os programas do Ministério da Educação")}else{$("#programas-more").addClass("active");if(!$.browser.safari)$("#programas-more").jScrollPane();$("#carousel .programas .graph").hide();$(this).text("Ocultar informações sobre os programas do Ministério da Educação")}return false});if(!$.browser.safari)$("#carousel .reportagem").jScrollPane({autoReinitialise:true})});var m;var layer;var tilejson={tilejson:"1.0.0",scheme:"xyz",tiles:["http://tiles.infoamazonia.org/v2/eduamazonia/{z}/{x}/{y}.png"],grids:["http://tiles.infoamazonia.org/v2/eduamazonia/{z}/{x}/{y}.grid.json"],formatter:function(e,t){var n="";n+='<div class="cidade-teaser dynamic-tip">';n+="<h2>"+t.cidade+"</h2>";n+="<h3>"+t.estado+"</h3>";n+='<p class="total">';n+='<span class="head">total de</span>';n+='<span class="n">'+t.constatacoes+"</span>";n+='<span class="foot">irregularidades</span>';n+="</p>";n+='<ul class="tipos">';if(t.despesa_irregular)n+="<li><span>"+t.despesa_irregular+"</span> em despesa irregular</li>";if(t.desvio_de_finalidade)n+="<li><span>"+t.desvio_de_finalidade+"</span> em desvio de finalidade</li>";if(t.falta_de_controle_administrativo)n+="<li><span>"+t.falta_de_controle_administrativo+"</span> em falta de controle administrativo</li>";if(t.falta_de_controle_social)n+="<li><span>"+t.falta_de_controle_social+"</span> em falta de controle social</li>";if(t.falta_de_prestacao_de_contas)n+="<li><span>"+t.falta_de_prestacao_de_contas+"</span> em falta de prestação de contas</li>";n+="</ul>";n+="</div>";return n}};$(document).ready(function(){layer=new wax.mm.connector(tilejson);m=new MM.Map("map",new wax.mm.connector(tilejson),null,[easey.DragHandler(),easey.TouchHandler(),easey.MouseWheelHandler(),easey.DoubleClickHandler()]);m.setCenterZoom(new MM.Location(-48,-7),4);wax.mm.zoomer(m).appendTo(m.parent);wax.mm.interaction().map(m).tilejson(tilejson).on(wax.tooltip().animate(false).parent(m.parent).events()).on({on:function(e){$(".default-tip").hide();$(".wax-tooltip .close").text("Fechar")},off:function(e){if(!$(".dynamic-tip").length)$(".default-tip").show();else $(".wax-tooltip .close").text("Fechar")}});var e=4;var t=8;var n=new MM.Location(9,-75);var r=new MM.Location(-37,-4);m.setZoomRange(e,t);m.coordLimits=[m.locationCoordinate(n).zoomTo(e),m.locationCoordinate(r).zoomTo(t)];layer.tileLimits=[m.locationCoordinate(n).zoomTo(e),m.locationCoordinate(r).zoomTo(t)]});$(document).ready(function(){$("nav#main-nav a").click(function(){var e=$(this).data("section");if(e){loadSection(e);return false}})});google.load("visualization","1",{packages:["corechart"]});var irregularidadesData;var currentData;var eduamazonia={};var selectedFilters={};var categories=[];var resultsScrollApi;var sectionLoaded={};sectionLoaded.navegue=false;(function(e){e.fn.carousel=function(t){function u(t){r.find("li").removeClass("active");r.find("[data-slide='"+t+"']").addClass("active");var i=e(".carousel-content").find("[data-slide='"+t+"']");var o=i.position();var u=o.left;n.find(".carousel-content").stop().animate({left:-u},s)}function a(){var e=r.find("li.active").data("slide");var t=n.find("[data-slide='"+e+"']").next();if(t.length)var i=t.data("slide");else var i=n.find("li:nth-child(1)").data("slide");u(i)}function f(){var e=r.find("li.active").data("slide");var t=n.find("[data-slide='"+e+"']").prev();if(t.length)var i=t.data("slide");else var i=n.find("li:last-child").data("slide");u(i)}var n=e(this);var r=e(this).find("nav");var i=n.attr("id");var s=t.slideSpeed;var o=n.find(".carousel-content > li").length;n.find(".carousel-content").each(function(){var t=e(this).find("> li").width();var n=t*o;e(this).width(n)});r.find("a").click(function(){u(e(this).parent().data("slide"));if(t.autoRotate)e.doTimeout(i,slideTimer,function(){a();return true});return false});if(t.autoRotate)e.doTimeout(i,slideTimer,function(){a();return true});n.find(".next").click(function(){a();return false});n.find(".prev").click(function(){f();return false})}})(jQuery);var normalize=function(){var e="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",t="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",n={};for(var r=0;r<e.length;r++)n[e.charAt(r)]=t.charAt(r);return function(e){var t=[];for(var r=0;r<e.length;r++){var i=e.charAt(r);if(n.hasOwnProperty(e.charAt(r)))t.push(n[i]);else t.push(i)}return t.join("").replace(/[^-A-Za-z0-9]+/g,"-").toLowerCase()}}()